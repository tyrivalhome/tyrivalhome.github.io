(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-daa249ce"],{"288b":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"dbSourceForm",attrs:{model:e.config.dataSource,rules:e.rules,size:"mini","label-width":"80px"}},[a("el-form-item",{attrs:{label:"域名/IP",prop:"host"}},[a("el-input",{model:{value:e.config.dataSource.host,callback:function(t){e.$set(e.config.dataSource,"host",t)},expression:"config.dataSource.host"}})],1),a("el-form-item",{attrs:{label:"端口",prop:"port"}},[a("el-input",{model:{value:e.config.dataSource.port,callback:function(t){e.$set(e.config.dataSource,"port",t)},expression:"config.dataSource.port"}})],1),a("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[a("el-input",{model:{value:e.config.dataSource.userName,callback:function(t){e.$set(e.config.dataSource,"userName",t)},expression:"config.dataSource.userName"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{model:{value:e.config.dataSource.password,callback:function(t){e.$set(e.config.dataSource,"password",t)},expression:"config.dataSource.password"}})],1),a("el-form-item",{attrs:{label:"数据库",prop:"db"}},[a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{placeholder:"请选择数据库"},model:{value:e.config.dataSource.db,callback:function(t){e.$set(e.config.dataSource,"db",t)},expression:"config.dataSource.db"}},e._l(e.db,(function(e,t){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-col",{attrs:{span:7,offset:1}},[a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:e.initDb}},[e._v("获取数据库列表")])],1)],1)],1)},r=[],n=a("7638"),i=a("a3be"),s={name:"DatabaseForm",props:["config"],data:function(){return{rules:{host:[{required:!0,message:"必须填写"}],port:[{required:!0,message:"必须填写"}],userName:[{required:!0,message:"必须填写"}],password:[{required:!0,message:"必须填写"}],db:[{required:!0,message:"必须填写"}]},db:[]}},mounted:function(){this.config&&this.config.dataSource.id&&this.config.dataSource.id&&this.initDb()},methods:{initDb:function(){var e=this;this.db=[];var t=this.config.dataSource;this.ajax({url:i["a"].DATA_SOURCE.LIST_DB,method:n["a"].AJAX.POST,data:{host:t.host,port:t.port,userName:t.userName,password:t.password,type:t.type}}).then((function(t){e.db=t.data}))}}},c=s,l=a("2877"),u=Object(l["a"])(c,o,r,!1,null,"3a7da4ee",null);t["default"]=u.exports},"32a0":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{width:"40%",title:e.config.dataSource.id?"编辑数据源":"新建数据源",visible:e.config.visible,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.config,"visible",t)}}},[a("el-form",{ref:"dataSourceForm",attrs:{model:e.config.dataSource,rules:e.rules,size:"mini","label-width":"80px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:e.config.dataSource.name,callback:function(t){e.$set(e.config.dataSource,"name",t)},expression:"config.dataSource.name"}})],1),a("el-form-item",{attrs:{label:"类型"}},[a("el-select",{attrs:{placeholder:"请选择数据源类型","default-first-option":!0},model:{value:e.config.dataSource.type,callback:function(t){e.$set(e.config.dataSource,"type",t)},expression:"config.dataSource.type"}},e._l(e.dataSourceType,(function(e){return a("el-option",{key:e.type,attrs:{label:e.desc,value:e.type}})})),1)],1)],1),a(e.form.loader[e.form.mapper[e.config.dataSource.type]].default,{ref:"subDsForm",tag:"component",attrs:{config:e.config}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v("确 定")]),a("el-button",{attrs:{size:"mini"},on:{click:function(t){e.config.visible=!1}}},[e._v("取 消")])],1)],1)},r=[],n=a("a3be"),i=a("7638"),s=a("2ef0"),c=a.n(s),l={name:"DataSourceEdit",props:["config"],data:function(){return{rules:{name:[{required:!0,message:"必须填写名称",trigger:"blur"}]},form:{mapper:{},url:{},loader:{}},dataSourceType:[{type:"EXCEL",desc:"XLS/CSV 文件",form:"FileForm",url:n["a"].DATA_SOURCE.SAVE_FILE},{type:"POSTGRESQL",desc:"PostgreSQL数据库",form:"DatabaseForm",url:n["a"].DATA_SOURCE.SAVE_DATABASE},{type:"MYSQL",desc:"MySQL数据库",form:"DatabaseForm",url:n["a"].DATA_SOURCE.SAVE_DATABASE},{type:"ORACLE",desc:"Oracle数据库",form:"DatabaseForm",url:n["a"].DATA_SOURCE.SAVE_DATABASE},{type:"SQLSERVER",desc:"SqlServer数据库",form:"DatabaseForm",url:n["a"].DATA_SOURCE.SAVE_DATABASE}]}},created:function(){this.loadForm(),this.config.dataSource||(this.config.dataSource=c.a.assignIn({},this.dataSourceType[0]))},methods:{save:function(){var e=this,t=this.$refs.dataSourceForm,a=this.$refs.subDsForm;t.validate((function(t,o){t&&a.$children[0].validate((function(t,a){if(t){var o=e.form.url[e.config.dataSource.type];e.ajax({url:o,method:i["a"].AJAX.POST,data:e.config.dataSource}).then((function(t){t.success&&(e.$message(i["a"].MESSAGE.SAVE_SUCCESS),e.config.visible=!1)}))}}))}))},loadForm:function(){for(var e=0;e<this.dataSourceType.length;e++){var t=this.dataSourceType[e],o=t.form;this.form.mapper[t.type]=o,this.form.url[t.type]=t.url,this.form.loader[o]||(this.form.loader[o]=a("5fac")("./"+o+".vue"))}}}},u=l,d=a("2877"),f=Object(d["a"])(u,o,r,!1,null,"54529620",null);t["default"]=f.exports},"4ef4":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form-item",{attrs:{label:"url",required:""}},[a("el-input",{model:{value:e.config.dataSource.url,callback:function(t){e.$set(e.config.dataSource,"url",t)},expression:"config.dataSource.url"}})],1),a("el-form-item",{attrs:{label:"协议",required:""}},[a("el-select",{attrs:{placeholder:"请选择协议类型"},model:{value:e.config.dataSource.protocol,callback:function(t){e.$set(e.config.dataSource,"protocol",t)},expression:"config.dataSource.protocol"}},e._l(e.protocol,(function(e,t){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1)},r=[],n={name:"ApiForm",props:["config"],data:function(){return{protocol:[{name:"http"},{name:"https"}]}}},i=n,s=a("2877"),c=Object(s["a"])(i,o,r,!1,null,"d93b1e12",null);t["default"]=c.exports},"5fac":function(e,t,a){var o={"./ApiForm.vue":"4ef4","./DatabaseForm.vue":"288b","./FileForm.vue":"8992"};function r(e){var t=n(e);return a(t)}function n(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=n,e.exports=r,r.id="5fac"},"7f7f":function(e,t,a){var o=a("86cc").f,r=Function.prototype,n=/^\s*function ([^ (]*)/,i="name";i in r||a("9e1e")&&o(r,i,{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(e){return""}}})},8992:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{attrs:{model:e.config.dataSource,rules:e.rules,size:"mini","label-width":"80px"}},[a("el-form-item",{attrs:{label:"",prop:"attachment"}},[a("el-upload",{attrs:{drag:"",limit:1,headers:e.getToken(),action:e.getUploadUrl(),"before-upload":e.beforeUpload,"on-remove":e.remove,"on-success":e.onSuccess,"on-exceed":e.onExceed,"on-Error":e.onError}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传xls、xlsx、csv文件")])])],1)],1)},r=[],n=(a("7f7f"),a("a3be")),i=a("7638"),s={name:"FileForm",props:["config"],data:function(){var e=this,t=function(t,a,o){e.config.dataSource.attachmentId?o():o(new Error("请上传文件。"))};return{rules:{attachment:[{validator:t,trigger:"change"}]}}},methods:{beforeUpload:function(e){var t=e.name,a=t.substring(t.lastIndexOf(".")+1).toLowerCase();if("xls"!==a&&"xlsx"!==a&&"csv"!==a)return this.$message({message:"只支持xls、xlsx、csv文件",type:"error"}),!1},getUploadUrl:function(){return n["a"].ATTACHMENT.UPLOAD},getToken:function(){return{token:this.$store.state.token}},remove:function(e,t){var a=this;this.config.dataSource.id&&(this.ajax({url:n["a"].ATTACHMENT.DELETE,params:{id:this.config.dataSource.id}}).then((function(e){e.data.success&&a.$message(i["a"].MESSAGE.DELETE_SUCCESS)})),this.config.dataSource.id=null)},onSuccess:function(e){this.config.dataSource.attachmentId=e.data.id},onError:function(e){this.$message({message:e.data.message,type:"error"})},onExceed:function(e,t){this.$message({message:"最多只可上传1个文件，请删除当前文件后再上传",type:"error"})}}},c=s,l=a("2877"),u=Object(l["a"])(c,o,r,!1,null,"48386735",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-daa249ce.d65e2c69.js.map